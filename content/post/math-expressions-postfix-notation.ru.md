---
title: Разбор математических выражений на C#. Постфиксная нотация
_oembed_2ce488e0d7c8b22a5e28c427a972ef45: "<div class=\"github-embed github-embed-repository github-logo-mark\">    <p>        <a href=\"https://github.com/itdranik/coding-interview\" target=\"_blank\">\t\t\t<strong>\t\t\t\tSamples for coding interview problems\t\t\t</strong>\t\t</a>\t\t<br>        <a href=\"https://github.com/itdranik/coding-interview\" target=\"_blank\">https://github.com/itdranik/coding-interview</a><br>        <a href=\"https://github.com/itdranik/coding-interview/network\" target=\"_blank\">0</a> forks.<br>        <a href=\"https://github.com/itdranik/coding-interview/stargazers\" target=\"_blank\">0</a> stars.<br>        <a href=\"https://github.com/itdranik/coding-interview/issues\" target=\"_blank\">0</a> open issues.<br>        Recent commits:        <ul class=\"github_commits\">                            <li class=\"github_commit\">                    <a href=\"https://github.com/itdranik/coding-interview/commit/84835549faa653cd1879e08ecb0f44959db01bdb\" target=\"_blank\">Initial commit</a>, GitHub                </li>                    </ul>    </p></div>"
_oembed_time_2ce488e0d7c8b22a5e28c427a972ef45: "1581792996"
_wp_old_slug: '%d1%80%d0%b0%d0%b7%d0%b1%d0%be%d1%80-%d0%bc%d0%b0%d1%82%d0%b5%d0%bc%d0%b0%d1%82%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%b8%d1%85-%d0%b2%d1%8b%d1%80%d0%b0%d0%b6%d0%b5%d0%bd%d0%b8%d0%b9-%d1%87%d0%b0%d1%81'
author: yauheni.shybeka
categories:
  - coding-interview
image: /wp-content/uploads/2020/02/math-expressions-feature-image-1.jpg
date: "2020-02-15T08:00:00+00:00"
language:
  - English
tags:
  - c#
  - математические-выражения
  - парсер

---
Ну здравствуй, уважаемый читатель!

Кто же, как не мы, прожженные жизнью и монитором разработчики, знает как противоречив, труден и несправедлив этот мир технических собеседований! Пусть твои решения запускают космические корабли, или твой сервис удерживает миллионы запросов, опытный интервьюер всегда выведет тебя на чистую воду. Не можешь с ходу вспомнить разницу между сортировкой слиянием и вставками, не знаешь наизусть все SOLID принципы? О, друг мой, в отличие от тебя интервьюер подготовился серьёзнее и ещё с утра повторил эти важные темы. Твоя некомпетентность очевидна. Пересдача!

Конечно в следующий раз эти вопросы не застанут тебя врасплох, ты сам теперь поражаешься, как человек не может сходу реализовать сортировку кучей, или наизусть не помнит все правила балансировки красно-чёрных деревьев. Тебя снова зовут на собеседование, и какое удивительное совпадение: снова попадается тот же интервьюер. Вот он момент истины, теперь ты знаешь про сортировки всё, ты уже готов ударить по клавишам, как неожиданно читаешь постановку вопроса: "Реализовать парсер математических выражений".

Неожиданно? Естественно. И поэтому, чтобы в этот раз всё получилось, предлагаю прямо здесь и сейчас разобраться с этим вопросом. Итак, приступим!

**Постановка задачи**: реализовать парсер математических выражений.

Конечно с такой формулировкой работать сложно, поэтому желательно на технических собеседованиях придерживаться правила: сначала обсудить ограничения, потом приступать к реализации. Если есть желание ввести интервьюера в состояние экстаза, то стоит предложить зафиксировать ограничения в виде набора тестов.

Введём следующий набор ограничений:

- Выражение не может содержать переменных или именованных констант, состоит только из чисел, арифметических знаков и скобок;
- Допустимы следующие арифметические знаки: `+, -, *, /`;
- Допустимы только круглые скобки;
- Если выражение содержит синтаксическую или вычислительную ошибку, то необходимо вместо результата вернуть сообщение об ошибке;

Сложность разбора или парсинга математических выражений заключается в том, что математические операции имеют разный приоритет, который также может изменяться с помощью скобок. Звучит сложно? На самом деле достаточно преобразовать выражение из инфиксной нотации в постфиксную с помощью алгоритма сортировочной станции, выполнить расчёт и всё! Казалось бы, можно на этом завершать пост, но вероятнее всего злобный интервьюер захочет углубиться в детали, а ещё, чего доброго, потребует реализации. Поэтому продолжим.

**Инфиксная нотация** \- форма записи математических выражений, в которой операторы (в нашем случае арифметические знаки) записаны между операндами (в нашем случае числами), на которые они применяются. Порядок вычислений определяется приоритетом операторов, но может регулироваться скобками. Таким образом, инфиксная нотация \- это стандартная форма записи выражений, которой нас обучали ещё в школе, например: `1 + (2 - 3) * 4`.

**Постфиксная нотация** \- форма записи математических выражений, в которой операторы записаны после операндов, на которых они применяются. В данной нотации отсутствует приоритет операций, а следовательно отсутствуют скобки. Например, выражению выше будет соответствовать следующее выражение в постфиксной нотации: `2 3 - 4 * 1 +` или `4 2 3 - * 1 +`.

Полную реализацию на C# можно найти на [GitHub](https://github.com/itdranik/coding-interview/) проекта coding-interview, а пока разберём алгоритм вычисления выражения, записанного в постфиксной нотации. Создадим класс, который на вход будет принимать последовательное множество токенов (операторов и операндов), а на выходе будет возвращать результат в ввиде вычисленного операнда.

Если токен является операндом, то добавляем операнд в стек операндов.

Если же токен является оператором, то достаём необходимое количество операндов из стека, производим вычисление и добавляем результат вычисления назад в стек операндов. Если же в стеке нет необходимого числа элементов для вычисления оператора, то сигнализируем об ошибке.

Осталось лишь добавить реализацию возвращения результата \- единственного элемента в стеке. Если после обработки всех токенов в стеке находится больше одного элемента, то это будет сигнализировать о наличии несоответствия между операторами и операндам. Если же в стеке нет элементов, то это значит, что на вход была подана пустая последовательность.

На этом мне надо прощаться, а уже в [следующем посте](/ru/post/math-expressions-shunting-yard-algorithm/) разберём реализацию алгоритма сортировочной станции.
