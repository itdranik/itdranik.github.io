---
title: Разбор математических выражений на C#. Токенизация
_wp_old_date: "2020-02-27"
_wp_old_slug: '%d1%80%d0%b0%d0%b7%d0%b1%d0%be%d1%80-%d0%bc%d0%b0%d1%82%d0%b5%d0%bc%d0%b0%d1%82%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%b8%d1%85-%d0%b2%d1%8b%d1%80%d0%b0%d0%b6%d0%b5%d0%bd%d0%b8%d0%b9-%d1%87%d0%b0%d1%81-3'
author: yauheni.shybeka
categories:
  - coding-interview
image: /wp-content/uploads/2020/02/math-expressions-feature-image-1.jpg
date: "2024-05-06T00:14:34+00:00"
language:
  - English
tags:
  - c#
  - математические-выражения
  - парсер

---
Наука постоянно развивается, технологии стремительно врываются в нашу жизнь, появляются новые инструменты и возможности, неизменно лишь одно \- угрюмое выражение лица твоего интервьюера. И если с чтением эмоций интервьювера мы разобрались, то с чтением выражения у нас всё ещё есть проблемы. Поэтому в данном посте разберём самую простую тему в контексте данной задачи \- разбиение исходной строки на отдельные токены.

Как упоминалось в предыдущих постах про [постфиксную нотацию](/ru/post/math-expressions-postfix-notation/) и [алгоритм сортировочной станции](/ru/post/math-expressions-shunting-yard-algorithm/), мы имеем следующие виды токенов:

1. Знаки арифметических операций `+, -, *, /`;
1. Круглые скобки `(, )`;
1. Вещественные числа. Для простоты ограничимся только числами с десятичным разделителем;
1. В качестве разделителей токенов может выступать только символ пробела.

Создадим тело основного метода на C#. Будем читать выражение символ за символом и сразу обрабатывать. Для нашего случая этого достаточно, в других случаях лексические анализаторы могут требовать более сложных подходов. Данная тема достаточно хорошо рассмотрена в [той самой книге](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%82%D0%BE%D1%80%D1%8B:_%D0%BF%D1%80%D0%B8%D0%BD%D1%86%D0%B8%D0%BF%D1%8B,_%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8_%D0%B8_%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B).

Для начала реализуем самый простой вариант: входная строка содержит только одно число, пробелы и операторы отсутствуют.

- Пока есть символы, добавляем символы в отдельное хранилище, на основе которых будем формировать результирующее число;
- Если в хранилище есть символы, то конвертируем символы в число и добавляем в список результирующих токенов.

Усложним немного задачу: разрешим использование нескольких чисел, разделенных пробелами. Тогда разбиение на токены можно представить в следующем виде:

- Пока есть символы, анализируем очередной символ:

  - Если символ является разделителем (пробелом), то конвертируем сохраненные в хранилище символы в число и добавляем в список результирующих токенов;

  - Иначе используем символ для формирования числа в отдельном хранилище;
- Если в хранилище остались символы, то конвертируем символы в число и добавляем в список результирующих токенов.

Добавим теперь поддержку обработки операторов. Так как в нашей постановки задачи все операторы выражаются ровно одним символом, то при встрече символа оператора будем сразу добавлять оператор в результирующую последовательность. При этом если в хранилище содержатся символы для формирования числа, то конвертируем их в число. Тогда финальный алгоритм будет выглядеть следующим образом:

- Пока есть символы, анализируем очередной символ:
  - Если символ является разделителем (пробелом), то конвертируем сохраненные в хранилище символы в число и добавляем в список результирующих токенов;
  - Если символ является оператором, то конвертируем сохраненные в хранилище символы в число и добавляем в список результирующих токенов, после чело добавляем токен оператора в результирующий список;
  - Иначе используем символ для формирования числа в отдельном хранилище;
- Если в хранилище остались символы, то конвертируем символы в число и добавляем в список результирующих токенов.

Как всегда полную реализацию можно посмотреть на [GitHub](https://github.com/itdranik/coding-interview/) проекта coding-interview, а этим постом будем заканчивать тему разбора математических выражений. Надеюсь, что всё было познавательно и интересно. До встречи!
